function callbackSuccessAjax(e){alertify.success("Listo.")}function callbackErrorAjax(e){responseJSON=e.responseJSON,responseJSON.errors_form&&alertify.error("Ha Ocurrido un Error")}function serializeForm(e){var a=new FormData(e);return $(e).find("input[type=file]").each(function(e,n){$.each(n.files,function(n,r){a.append("file-"+e,r)})}),$(e).find("input[type=checkbox]").each(function(e,n){var r=n.checked?1:0;a.append(n.name,r)}),a}function openNewWindow(e,a,n){if(window.location.href!=e){var r=window.innerHeight>0?window.innerHeight:screen.height,t=window.innerWidth>0?window.innerWidth:screen.width,o=screen.width/2-t/2,s=screen.height/2-r/2,i=window.open(e,"","height="+r+",width="+t+",left="+o+",top="+s);i.ASIES_IS_WIN_POPUOT=!0,i.FIND_TASK=n.find_task||!1,i.FIND_PLAN=n.find_plan||!0,i.TYPE_PLAN=n.type_plan||null,i.INPUT_REFERENCE=a}}Array.prototype.isEmpty=function(){return 0==this.length},Array.prototype.lengthIs=function(e){return this.length==e},String.prototype.set=function(e,a){var n=new RegExp(e,"g");return this.replace(n,a)},String.prototype.truncate=function(e,a){return e>this.length?this:this.substr(0,e)+(a=a||"...")};var DTspanish={sProcessing:"Procesando...",sLengthMenu:"Mostrar _MENU_ registros",sZeroRecords:"No se encontraron resultados",sEmptyTable:"Ningún dato disponible en esta tabla",sInfo:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",sInfoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",sInfoFiltered:"(filtrado de un total de _MAX_ registros)",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"Primero",sLast:"Último",sNext:"Siguiente",sPrevious:"Anterior"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"}};alertify.defaults.glossary.acccpt="Aceptar",alertify.defaults.glossary.cancel="Cancelar",alertify.defaults.glossary.close="Cerrar",alertify.defaults.glossary.confirm="Confirmar",alertify.defaults.glossary.decline="Rechazar",alertify.defaults.glossary.maximize="Maximizar",alertify.defaults.glossary.ok="Si",alertify.defaults.glossary.restore="Restaurar",alertify.defaults.glossary.title="ASIES";var spanishMessagesJTable={serverCommunicationError:"Se ha producido un error al comunicarse con el servidor.",loadingMessage:"Cargando...",noDataAvailable:"¡Datos no disponibles!",addNewRecord:"Agregar",editRecord:"Editar",areYouSure:"¿Estás seguro?",deleteConfirmation:"Este registro se eliminará. ¿Estás seguro?",save:"Guardar",saving:"Guardando",cancel:"Cancelar",deleteText:"Borado",deleting:"Borrando",error:"Error",close:"Cerrar",cannotLoadOptionsFor:"No se pueden cargar las opciones para el campo {0}",pagingInfo:"Mostrando {0}-{1} de {2}",pageSizeChangeLabel:"Numero de filas",gotoPageLabel:"Ir a la Pagina",canNotDeletedRecords:"No se pueden eliminar {0} de {1} registros!",deleteProggress:"Eliminando {0} de {1} registros, Procesando..."};$(document).ready(function(){$("select").select2({width:"100%"}),$("[data-find-treetask]").change(function(event){eval($(this).data("find-task"))?Models.Tareas.exists(this.value)||(this.value=""):eval($(this).data("find-plan"))&&(Models.Planes.exists(this.value)||(this.value=""))}),$("[data-find-treetask]").click(function(event){var selector=$(this).data("input-reference"),data={find_task:eval($(this).data("find-task"))||!1,find_plan:eval($(this).data("find-plan"))||!1,type_plan:$(this).data("type-plan")||null};openNewWindow("/planes/treeview",selector,data)}),$(".btn-logout").click(function(e){e.preventDefault(),alertify.confirm("Desea cerrar Sesión",function(e){e&&window.location.replace("/logout")})})}),Models={Utils:{dataToTreeview:function(e){function a(e){return e.map(function(e){if(e.subplanes&&e.subplanes.length>0&&(e.subplanes=a(e.subplanes)),e.ctarea){var n="1"==e.ifhecha?e.valor_tarea:0;return{text:e.ntarea+"("+n+")",li_attr:{ctarea:e.ctarea,valor:n},type:"tareas"}}if(e.cplan){var r=Models.Planes.calcular_porcentaje(e),t="("+e.valor_plan+"/"+e.valor_total+")";return{text:e.nplan+t+"("+r+"%)",li_attr:{cplan:e.cplan,valor:e.valor_plan,ctiplan:e.ctiplan,cpuntuacion:e.cpuntuacion,"data-state":e.puntuacion.sigla,"data-color":e.puntuacion.color},type:e.tiplan.slug,children:e.subplanes}}})}return e=e.map(function(e){e.subplanes.length>0&&(e.subplanes=a(e.subplanes));var n=Models.Planes.calcular_porcentaje(e),r="("+e.valor_plan+"/"+e.valor_total+")";return{text:e.nplan+r+"("+n+"%)",state:{opened:!0},li_attr:{cplan:e.cplan,valor:e.valor_plan,cpuntuacion:e.cpuntuacion,"data-state":e.puntuacion.sigla,"data-color":e.puntuacion.color,select_treeview:"treeview___cplan__".set("__cplan__",e.cplan)},type:e.tiplan.slug,children:e.subplanes}})}},Evidencias:{set:function(e,a,n){$.ajax({type:"PUT",url:"/api/evidencias/"+e+"/set",contentType:"application/json",success:n,data:a,error:function(){}})}},Tareas:{findOne:function(e,a){$.ajax({type:"GET",url:"/api/tareas/"+e,success:a,error:a})},exists:function(e,a){Models.Tareas.findOne(e,function(e){404==e.status&&a(!1),e.cplan&&a(!0)})},cambiarEstado:function(e,a,n){$.ajax({url:"/api/actividades/__cactividad__/tareas/__ctarea__/do".set("__ctarea__",a).set("__cactividad__",e),type:"POST",success:function(r){r.ok?alertify.success(r.msg):alertify.warning(r.msg),r.cactividad=e,r.ctarea=a,"function"==typeof n&&n(r)},error:function(e){}})}},Actividades:{sendReminders:function(){waitingDialog.show("Enviando Correos"),$.ajax({url:"/actividades/checkDates",type:"POST",success:function(e){waitingDialog.hide(),console.info(e);var a=e.status.map(function(e){return{emails:e.emails,failures:e.failures}});console.info(a);var n="Se han enviado recordatorios a : ";if(e.emails instanceof Array)e.emails.forEach(function(e){n+=e+",<br>"});else for(k in e.emails)n+=e.emails[k]+",<br>";n+="<br> Han Ocurrido los errores : ",alertify.success("Los Recordatorios se han enviado."),console.info(n),alertify.alert(n)},error:function(e){waitingDialog.hide(),alertify.error("Ha ocurrido un error al enviar los Recordatorios.")}})},changeState:function(e,a){var n=(n="/api/Actividades/__id__/property?property=cestado").replace("__id__",e);void 0!==a&&(n=(n+="&value=__cestado__").replace("__cestado__",a)),$.ajax({url:n,type:"POST",dataType:"json",success:function(e){console.log(e)},error:function(e){}})},asignarTarea:function(e,a,n){if("object"!=typeof a)return!1;var r="/api/actividades/"+e+"/assign";$.ajax({url:r,type:"POST",data:a,success:function(e){e.ok?(alertify.success(e.msg),"function"==typeof n&&n(e)):(alertify.warning(e.msg),"function"==typeof n&&n(e))},error:function(e){}})},removerTarea:function(e,a,n){var r="/api/actividades/"+e+"/assign";$.ajax({url:r,type:"DELETE",data:{ctarea:a},success:function(e){e.ok?(alertify.success(e.msg),"function"==typeof n&&n(e)):(alertify.warning(e.msg),"function"==typeof n&&n(e))},error:function(e){}})}},Actas:{compromisos:{agregar:function(e,a){}}},Planes:{messages:{create:{success:"El Plan se ha creado Exitosamente",error:"Ops. Algo no ha salido bien."},validation:{multipleSelection:"Solo debe Seleccionar un plan",notSelection:"Debe Seleccionar al menos un plan",notSelectCorrectParent:"Debe Seleccionar el plan correcto"}},exists:function(e,a){Models.Planes.findOne(e,function(e){404==e.status&&a(!1),e.cplan&&a(!0)})},findOne:function(e,a){$.ajax({type:"GET",url:"/api/planes/"+e,success:a,error:a})},all:function(e){$.ajax({type:"GET",url:"/api/planes",success:e,error:function(){}})},calcular_porcentaje:function(e){var a=parseInt(100*e.valor_plan/e.valor_total);return isNaN(a)&&(a=0),a},recalcular:function(e){alertify.confirm("Desea recalcular los puntos de los Planes, recuerde que este proceso puede tardar varios minutos, en los cuales no se podrán realizar ninguna otra acción.",function(){waitingDialog.show("Recalculando Puntos",{onHide:function(){}}),$.ajax({type:"POST",url:"/planes/recalcular",success:function(a){waitingDialog.hide(),alertify.success("Puntos Recalculados"),e&&e(a)},error:function(e){alertify.error(e.responseJSON.message),waitingDialog.hide()}})})},treeview:function(e,a){void 0===a?$.ajax({type:"GET",url:"/api/planes",success:function(a){var n=Models.Utils.dataToTreeview(a);return e(n)},error:function(){}}):$.ajax({type:"GET",url:"/api/planes/"+a,success:function(a){var n=Models.Utils.dataToTreeview([a]);return e(n)},error:function(){}})}}};